version: 2
jobs:
    build:
        working_directory: ~/app
        docker:
            -   image: circleci/python:3.6
                environment:
                    PIP_EXTRA_INDEX_URL: https://jessie.wheelhouse.praekelt.org/simple/
            -   image: mdillon/postgis:9.4
                environment:
                    POSTGRES_USER: rapidpro
                    POSTGRES_DB: rapidpro
                    POSTGRES_PASSWORD: rapidpro
            -   image: praekeltfoundation/rapidpro:v3
                environment:
                    EXTRA_INSTALLED_APPS: warapidpro
                    DATABASE_URL: postgis://rapidpro:rapidpro@localhost/rapidpro
        steps:
            -   checkout
            -   run:
                    name: "Run RapidPro checks"
                    command: |
                        /venv/bin/python /rapidpro/manage.py test warapidpro -v3
